<div class="anime-grid">
    {% for item in anime_list %}
    {% with anime=item.anime|default:item status=item.status %}

    <a href="{% url 'anime_detail' slug=anime.code %}{% if from_library %}?ref=library{% endif %}" class="anime-card"
        data-name="{{ anime.name_ru|lower }}" data-status="{{ status }}">

        <div class="poster-wrapper loading">
            {% if status %}
            <div class="status-badge-overlay">
                {% if status == 'watching' %}–°–º–æ—Ç—Ä—é
                {% elif status == 'planned' %}–í –ø–ª–∞–Ω–∞—Ö
                {% elif status == 'completed' %}–ì–æ—Ç–æ–≤–æ
                {% elif status == 'dropped' %}–ë—Ä–æ—à–µ–Ω–æ
                {% else %}{{ status }}{% endif %}
            </div>
            {% endif %}

            {% if anime.poster_path %}
            <img src="{{ anime.poster_path }}" width="455" height="650" alt="{{ anime.name_ru }}" loading="lazy"
                decoding="async" onload="this.parentElement.classList.remove('loading')">
            {% else %}
            <div class="no-poster"><span>–ù–µ—Ç —Ñ–æ—Ç–æ</span></div>
            {% endif %}

            <div class="card-overlay">
                <div class="play-icon">‚ñ∂</div>
            </div>
        </div>

        <div class="card-info">
            <h3 class="card-title">{{ anime.name_ru }}</h3>

            <div class="card-meta">
                {% if anime.updated_at %}
                <span class="date-badge">{{ anime.updated_at|date:"Y" }}</span>
                {% endif %}
                {% if item.current_episode %}
                <span class="ep-badge">{{ item.current_episode }} —Å–µ—Ä.</span>
                {% endif %}
            </div>
        </div>
    </a>
    {% endwith %}

    {% empty %}
    {# –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ #}
    <div class="empty-state">
        <div class="empty-icon">üìÇ</div>
        <h3>{{ empty_msg|default:"–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ" }}</h3>
        <p>–î–æ–±–∞–≤—å—Ç–µ –∞–Ω–∏–º–µ –≤ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫.</p>
        <a href="{% url 'home' %}" class="btn-primary">–ù–∞–π—Ç–∏ –∞–Ω–∏–º–µ</a>
    </div>
    {% endfor %}
</div>
